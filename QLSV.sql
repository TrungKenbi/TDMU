-- TAO CSDL QLSV
CREATE DATABASE QLSV
GO

-- SU DUNG CSDL
USE QLSV
GO

-- TAO BANG SVIEN
CREATE TABLE SVIEN
(
	MASV INT PRIMARY KEY,
	TEN NCHAR(20) NOT NULL,
	NAM INT,
	KHOA CHAR(4)
)


-- TAO BANG MHOC
CREATE TABLE MHOC
(
	MAMH CHAR(8) PRIMARY KEY,
	TENMH NCHAR(20) NOT NULL,
	TINCHI INT NOT NULL,
	KHOA CHAR(4)
)

-- TAO BANG DKIEN
CREATE TABLE DKIEN
(
	MAMH CHAR(8) REFERENCES MHOC(MAMH),
	MAMH_TRUOC CHAR(8) REFERENCES MHOC(MAMH),
	PRIMARY KEY(MAMH, MAMH_TRUOC)
)

-- TAO BANG KHOC
CREATE TABLE K_HOC
(
	MAKH INT PRIMARY KEY,
	MAMH CHAR(8) REFERENCES MHOC(MAMH),
	HOCKY INT NOT NULL,
	NAM INT NOT NULL,
	GV NCHAR(20)
)

-- TAO BANG KQUA
CREATE TABLE KQUA
(
	MASV INT REFERENCES SVIEN(MASV),
	MAKH INT REFERENCES K_HOC(MAKH),
	DIEM INT
)

GO

-----------------------------------------------------------------------

-- INSERT DATA TO SVIEN
INSERT INTO SVIEN (MASV, TEN, NAM, KHOA) VALUES (17, 'Son', 1, 'KTCN')
INSERT INTO SVIEN (MASV, TEN, NAM, KHOA) VALUES (8, 'Bao', 2, 'KTCN')
GO

-- INSERT DATA TO MHOC
INSERT INTO MHOC(MAMH, TENMH, TINCHI, KHOA) VALUES ('COSC1310', 'Nhap mon nganh', 3, 'KTCN')
INSERT INTO MHOC(MAMH, TENMH, TINCHI, KHOA) VALUES ('COSC3380', 'Cau truc du lieu', 4, 'KTCN')
INSERT INTO MHOC(MAMH, TENMH, TINCHI, KHOA) VALUES ('MATH2410', 'Toan cao cap', 3, 'TOAN')
INSERT INTO MHOC(MAMH, TENMH, TINCHI, KHOA) VALUES ('COSC3320', 'Co so du lieu', 3, 'KTCN')
GO

-- INSERT DATA TO DKIEN
INSERT INTO DKIEN(MAMH, MAMH_TRUOC) VALUES ('COSC3380', 'COSC3320')
INSERT INTO DKIEN(MAMH, MAMH_TRUOC) VALUES ('COSC3380', 'MATH2410')
INSERT INTO DKIEN(MAMH, MAMH_TRUOC) VALUES ('COSC3320', 'COSC1310')
GO

-- INSERT DATA TO K_HOC
INSERT INTO K_HOC(MAKH, MAMH, HOCKY, NAM, GV)
VALUES (85, 'MATH2410', 1, 2016, 'Ngan')
INSERT INTO K_HOC(MAKH, MAMH, HOCKY, NAM, GV)
VALUES (92, 'COSC1310', 1, 2017, 'Thuy')
INSERT INTO K_HOC(MAKH, MAMH, HOCKY, NAM, GV)
VALUES (102, 'COSC3320', 2, 2017, 'Xuan')
INSERT INTO K_HOC(MAKH, MAMH, HOCKY, NAM, GV)
VALUES (112, 'MATH2410', 1, 2018, 'Ngan')
INSERT INTO K_HOC(MAKH, MAMH, HOCKY, NAM, GV)
VALUES (119, 'COSC1310', 1, 2018, 'Thuy')
INSERT INTO K_HOC(MAKH, MAMH, HOCKY, NAM, GV)
VALUES (135, 'COSC3380', 1, 2016, 'Nam')
GO

-- INSERT DATA TO KQUA
INSERT INTO KQUA(MASV, MAKH, DIEM) VALUES (17, 112, 7);
INSERT INTO KQUA(MASV, MAKH, DIEM) VALUES (17, 119, 5);
INSERT INTO KQUA(MASV, MAKH, DIEM) VALUES (8, 85, 8);
INSERT INTO KQUA(MASV, MAKH, DIEM) VALUES (8, 92, 9);
INSERT INTO KQUA(MASV, MAKH, DIEM) VALUES (17, 85, 8);
INSERT INTO KQUA(MASV, MAKH, DIEM) VALUES (8, 135, 10);
GO



-- ======== TRUY VAN DU LIEU ========= --

-- IN RA TEN CAC SV
SELECT TEN FROM SVIEN;

-- IN RA CAC MON HOC VA SO TIN CHI
SELECT TENMH, TINCHI FROM MHOC;

-- KET QUA HOC TAP SV MS 8
SELECT MAKH FROM KQUA WHERE MASV = 8;

-- MON HOC TRUOC
SELECT MAMH FROM DKIEN WHERE MAMH_TRUOC = 'COSC3320';

-- MON HOC SAU
SELECT MAMH_TRUOC FROM DKIEN WHERE MAMH = 'COSC3320';

-- DANH SACH SINH VIEN THUOC KHOA PHU TRACH MON TOAN
SELECT * FROM SVIEN WHERE KHOA = (SELECT KHOA FROM MHOC WHERE MAMH = 'MATH2410')


-- CAP NHAT SINH VIEN
UPDATE SVIEN SET NAM = 2 WHERE TEN = 'Son'

-- XOA DU LIEU DA NHAP VAO
TRUNCATE SVIEN;
TRUNCATE MHOC;
TRUNCATE DKIEN;
TRUNCATE K_HOC;
TRUNCATE KQUA;

-- XOA TAT CA CAC BANG DA TAO
DROP TABLE SVIEN;
DROP TABLE MHOC;
DROP TABLE DKIEN;
DROP TABLE K_HOC;
DROP TABLE KQUA;

